<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IMAGE Business of Beauty 2025 - Table Plan Lookup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #000000;
      --bg-elevated: #111111;
      --text: #ffffff;
      --text-muted: #cccccc;
      --accent: #ffffff;
      --border-subtle: #333333;
      --radius-lg: 16px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100vh;
      display: block;
    }

    .shell {
      width: 100%;
      max-width: 700px;
      padding: 16px;
      padding-bottom: 32px;
      margin: 0 auto;
    }

    .top-logo {
      display: block;
      margin: 0 auto;
      max-width: 50%;
      width: 45%;
      height: auto;
      padding-bottom: 16px;
    }

    header {
      text-align: center;
      margin-bottom: 16px;
    }

    header h1 {
      font-size: 1.5rem;
      margin: 0 0 4px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    header p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .table-link {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      color: #e6ca88;
      cursor: pointer;
      font: inherit;
      text-align: left;
    }

    .table-link:hover,
    .table-link:focus {
      text-decoration: underline;
      outline: none;
    }

    .card {
      background: radial-gradient(circle at top left, #1f1f1f 0, #050505 55%, #000000 100%);
      border-radius: 24px;
      padding: 14px;
      border: 1px solid var(--border-subtle);
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.02);
    }

    .mode-toggle {
      display: inline-flex;
      border-radius: var(--radius-pill);
      background: rgba(255, 255, 255, 0.06);
      padding: 3px;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .mode-toggle button {
      border: none;
      background: transparent;
      color: var(--text-muted);
      padding: 6px 14px;
      font-size: 16px;      /* readable, avoids iOS zoom issues */
      border-radius: var(--radius-pill);
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.18s ease, color 0.18s ease, transform 0.1s ease;
      font-weight: 600;     /* bold in all states */
    }

    .mode-toggle button.active {
      background: #e6ca88;  /* gold */
      color: #000;
      font-weight: 600;
      transform: translateY(-0.5px);
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 14px;
      margin-bottom: 14px;
    }

    .field {
      position: relative;
    }

    .field label {
      display: block;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .field input,
    .field select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.45);
      background: rgba(5, 5, 5, 0.9);
      color: var(--text);
      padding: 9px 14px;
      padding-right: 40px;
      font-size: 16px;      /* ≥16px to stop Safari zooming */
      line-height: 1.3;
      outline: none;
      appearance: none;
      margin-bottom: 6px;
    }

    .field input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .field select {
      cursor: pointer;
    }

    .field-icon {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.85rem;
      pointer-events: none;
      color: rgba(255, 255, 255, 0.5);
    }

    .input-shell {
      position: relative;
    }

    .clear-btn {
      position: absolute;
      right: 14px;
      top: 0;
      bottom: 0;
      margin: auto 0;
      transform: translateY(-2px);
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.45);
      background: rgba(255, 255, 255, 0.45);   /* filled same as outline */
      color: #000000;                           /* black “X” */
      font-size: 0.9rem;
      line-height: 1;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 0;
      cursor: pointer;
    }

    .clear-btn:focus-visible {
      outline: 2px solid #ffffff;
      outline-offset: 2px;
    }

    .hint {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .summary-row {
      display: flex;
      justify-content: flex-end;
      align-items: baseline;
      margin-top: 10px;
      font-size: 0.75rem;
      color: var(--text-muted);
      gap: 6px;
      flex-wrap: wrap;
      min-height: 1.2em;
    }

    .results {
      margin-top: 10px;
      border-top: none;   /* remove extra line */
      padding-top: 0;
      max-height: none;
      overflow: visible;
    }

    .result-item {
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .result-item:first-child {
      border-top: 1px solid rgba(255, 255, 255, 0.16); /* single divider above first result */
      padding-top: 10px;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    /* Bigger typography for results */
    .result-name {
      font-weight: 700;
      font-size: 1.125rem; /* ≈ 18px */
      letter-spacing: 0.02em;
    }

    .result-company {
      font-size: 1rem;     /* ≈ 16px */
      color: var(--text-muted);
      margin-top: 3px;
    }

    .result-table {
      margin-top: 6px;
      font-size: 0.95rem;  /* ≈ 15px */
      font-weight: 700;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #e6ca88;
    }

    .empty-state {
      padding: 16px 2px 6px;
      font-size: 0.86rem;
      color: var(--text-muted);
      text-align: left;
    }

    .error-state {
      padding: 10px 0 0;
      font-size: 0.8rem;
      color: #ffb3b3;
    }

    .results-hint {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* MAP STYLES */

    .room-map-wrapper {
      margin-top: 18px;
      padding-top: 0;
      border-top: none;   /* no extra line above map */
    }

    .map-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      margin: 0 0 6px;
    }

    .map-hint {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin: 0 0 10px;
    }

    .room-map {
      position: relative;
      max-width: 420px;
      margin: 0 auto;
    }

    .room-map svg {
      display: block;
      width: 100%;
      height: auto;
    }

    .map-table {
      cursor: pointer;
      transition: transform 0.18s ease;
    }

    /* Default: black circles, gold outline, gold bold numbers */
    .map-table circle {
      fill: #000000;
      stroke: #e6ca88;
      stroke-width: 3;
      transition: fill 0.18s ease,
                  stroke 0.18s ease,
                  stroke-width 0.18s ease,
                  transform 0.18s ease;
      transform-box: fill-box;
      transform-origin: 50% 50%;
    }

    .map-table text {
      fill: #e6ca88;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      font-weight: 700;
    }

    /* Active: gold circle, black bold number, slight magnification */
    .map-table.active circle {
      fill: #e6ca88;
      stroke: #000000;
      stroke-width: 4;
      transform: scale(1.05);
    }

    .map-table.active text {
      fill: #000000;
      font-weight: 700;
    }

    .map-table:hover circle {
      stroke-width: 4;
    }

    @media (min-width: 640px) {
      header h1 {
        font-size: 1.7rem;
      }

      .card {
        padding: 18px 18px 20px;
      }

      .controls {
        flex-direction: row;
        align-items: flex-end;
      }

      .controls .field {
        flex: 1 1 auto;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <header>
        <img
          src="https://www.image.ie/wp-content/uploads/2025/11/BOB2025-Logo.png"
          alt="IMAGE Business of Beauty 2025 Logo"
          class="top-logo"
        />
        <h1>Table Plan Lookup</h1>
        <p>Search the table plan by name, company, or table.</p>
      </header>

      <main class="card" aria-label="Guest search and table browser">
        <!-- Mode toggle -->
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
          <div class="mode-toggle" role="tablist" aria-label="Search mode">
            <button
              id="mode-search"
              class="active"
              role="tab"
              aria-selected="true"
              aria-controls="panel-search"
              type="button"
            >
              Search by name / company
            </button>
            <button
              id="mode-table"
              role="tab"
              aria-selected="false"
              aria-controls="panel-table"
              type="button"
            >
              Browse by table
            </button>
          </div>
        </div>

        <!-- Controls -->
        <section class="controls" aria-live="polite">
          <!-- Search field -->
          <div class="field" id="panel-search">
            <label for="searchInput">Search guests</label>

            <div class="input-shell">
              <input
                id="searchInput"
                type="text"
                placeholder="Type first name, last name, or company…"
                autocomplete="off"
              />
              <button
                type="button"
                id="clearSearch"
                class="clear-btn"
                aria-label="Clear search"
              >
                ×
              </button>
            </div>

            <p class="hint">Search ignores case and punctuation such as apostrophes.</p>
          </div>

          <!-- Table dropdown (kept for code simplicity, but always hidden) -->
          <div class="field" id="panel-table" style="display:none;">
            <label for="tableSelect">Table number</label>
            <select id="tableSelect">
              <option value="">All tables</option>
            </select>
            <span class="field-icon" aria-hidden="true">▾</span>
            <p class="hint">Browse by assigned table.</p>
          </div>
        </section>

        <!-- Summary -->
        <div class="summary-row" id="summaryRow" aria-live="polite">
          <span id="activeFilter"></span>
        </div>

        <!-- Error -->
        <div class="error-state" id="errorMessage" role="alert" style="display:none;"></div>

        <!-- Results -->
        <section class="results" id="results" aria-live="polite" aria-label="Guest results list"></section>

        <!-- Room map -->
        <section
          class="room-map-wrapper"
          id="roomMapWrapper"
          aria-label="Room layout"
          style="display:none;"
        >
          <h2 class="map-title">Table location</h2>
          <p class="map-hint">Tap any table on the map to see who is seated there.</p>

          <div class="room-map">
            <!-- Inline SVG room map -->
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 648 1106"
                 role="img"
                 aria-labelledby="mapTitle mapDesc">
              <title id="mapTitle">Room layout with numbered tables</title>
              <desc id="mapDesc">Tables 1 to 67 arranged in rows with a stage on the right-hand side.</desc>

              <!-- Outer frame -->
              <rect x="0" y="0" width="648" height="1106"
                    fill="#000000" stroke="#d0a85a" stroke-width="6" />

              <!-- Stage block on the far right -->
              <rect x="520" y="388" width="120" height="252"
                    fill="#d9b777" stroke="#f4e0a6" stroke-width="3" />
              <text x="580" y="518"
                    text-anchor="middle"
                    font-size="32" fill="#000000">
                STAGE
              </text>

              <!-- Row 1: 6 5 4 3 2 1 -->
              <g class="map-table" data-table="6">
                <circle cx="80" cy="90" r="32" />
                <text x="80" y="96" text-anchor="middle" font-size="24">6</text>
              </g>
              <g class="map-table" data-table="5">
                <circle cx="177.6" cy="90" r="32" />
                <text x="177.6" y="96" text-anchor="middle" font-size="24">5</text>
              </g>
              <g class="map-table" data-table="4">
                <circle cx="275.2" cy="90" r="32" />
                <text x="275.2" y="96" text-anchor="middle" font-size="24">4</text>
              </g>
              <g class="map-table" data-table="3">
                <circle cx="372.8" cy="90" r="32" />
                <text x="372.8" y="96" text-anchor="middle" font-size="24">3</text>
              </g>
              <g class="map-table" data-table="2">
                <circle cx="470.4" cy="90" r="32" />
                <text x="470.4" y="96" text-anchor="middle" font-size="24">2</text>
              </g>
              <g class="map-table" data-table="1">
                <circle cx="568" cy="90" r="32" />
                <text x="568" y="96" text-anchor="middle" font-size="24">1</text>
              </g>

              <!-- Row 2: 7 8 9 10 11 12 -->
              <g class="map-table" data-table="7">
                <circle cx="80" cy="174.18" r="32" />
                <text x="80" y="180.18" text-anchor="middle" font-size="24">7</text>
              </g>
              <g class="map-table" data-table="8">
                <circle cx="177.6" cy="174.18" r="32" />
                <text x="177.6" y="180.18" text-anchor="middle" font-size="24">8</text>
              </g>
              <g class="map-table" data-table="9">
                <circle cx="275.2" cy="174.18" r="32" />
                <text x="275.2" y="180.18" text-anchor="middle" font-size="24">9</text>
              </g>
              <g class="map-table" data-table="10">
                <circle cx="372.8" cy="174.18" r="32" />
                <text x="372.8" y="180.18" text-anchor="middle" font-size="24">10</text>
              </g>
              <g class="map-table" data-table="11">
                <circle cx="470.4" cy="174.18" r="32" />
                <text x="470.4" y="180.18" text-anchor="middle" font-size="24">11</text>
              </g>
              <g class="map-table" data-table="12">
                <circle cx="568" cy="174.18" r="32" />
                <text x="568" y="180.18" text-anchor="middle" font-size="24">12</text>
              </g>

              <!-- Row 3: 18 17 16 15 14 13 -->
              <g class="map-table" data-table="18">
                <circle cx="80" cy="258.36" r="32" />
                <text x="80" y="264.36" text-anchor="middle" font-size="24">18</text>
              </g>
              <g class="map-table" data-table="17">
                <circle cx="177.6" cy="258.36" r="32" />
                <text x="177.6" y="264.36" text-anchor="middle" font-size="24">17</text>
              </g>
              <g class="map-table" data-table="16">
                <circle cx="275.2" cy="258.36" r="32" />
                <text x="275.2" y="264.36" text-anchor="middle" font-size="24">16</text>
              </g>
              <g class="map-table" data-table="15">
                <circle cx="372.8" cy="258.36" r="32" />
                <text x="372.8" y="264.36" text-anchor="middle" font-size="24">15</text>
              </g>
              <g class="map-table" data-table="14">
                <circle cx="470.4" cy="258.36" r="32" />
                <text x="470.4" y="264.36" text-anchor="middle" font-size="24">14</text>
              </g>
              <g class="map-table" data-table="13">
                <circle cx="568" cy="258.36" r="32" />
                <text x="568" y="264.36" text-anchor="middle" font-size="24">13</text>
              </g>

              <!-- Row 4: 19 20 21 22 23 -->
              <g class="map-table" data-table="19">
                <circle cx="80" cy="342.54" r="32" />
                <text x="80" y="348.54" text-anchor="middle" font-size="24">19</text>
              </g>
              <g class="map-table" data-table="20">
                <circle cx="177.6" cy="342.54" r="32" />
                <text x="177.6" y="348.54" text-anchor="middle" font-size="24">20</text>
              </g>
              <g class="map-table" data-table="21">
                <circle cx="275.2" cy="342.54" r="32" />
                <text x="275.2" y="348.54" text-anchor="middle" font-size="24">21</text>
              </g>
              <g class="map-table" data-table="22">
                <circle cx="372.8" cy="342.54" r="32" />
                <text x="372.8" y="348.54" text-anchor="middle" font-size="24">22</text>
              </g>
              <g class="map-table" data-table="23">
                <circle cx="470.4" cy="342.54" r="32" />
                <text x="470.4" y="348.54" text-anchor="middle" font-size="24">23</text>
              </g>

              <!-- Row 5: 28 27 26 25 24 -->
              <g class="map-table" data-table="28">
                <circle cx="80" cy="426.72" r="32" />
                <text x="80" y="432.72" text-anchor="middle" font-size="24">28</text>
              </g>
              <g class="map-table" data-table="27">
                <circle cx="177.6" cy="426.72" r="32" />
                <text x="177.6" y="432.72" text-anchor="middle" font-size="24">27</text>
              </g>
              <g class="map-table" data-table="26">
                <circle cx="275.2" cy="426.72" r="32" />
                <text x="275.2" y="432.72" text-anchor="middle" font-size="24">26</text>
              </g>
              <g class="map-table" data-table="25">
                <circle cx="372.8" cy="426.72" r="32" />
                <text x="372.8" y="432.72" text-anchor="middle" font-size="24">25</text>
              </g>
              <g class="map-table" data-table="24">
                <circle cx="470.4" cy="426.72" r="32" />
                <text x="470.4" y="432.72" text-anchor="middle" font-size="24">24</text>
              </g>

              <!-- Row 6: 29 30 31 32 33 -->
              <g class="map-table" data-table="29">
                <circle cx="80" cy="510.90" r="32" />
                <text x="80" y="516.90" text-anchor="middle" font-size="24">29</text>
              </g>
              <g class="map-table" data-table="30">
                <circle cx="177.6" cy="510.90" r="32" />
                <text x="177.6" y="516.90" text-anchor="middle" font-size="24">30</text>
              </g>
              <g class="map-table" data-table="31">
                <circle cx="275.2" cy="510.90" r="32" />
                <text x="275.2" y="516.90" text-anchor="middle" font-size="24">31</text>
              </g>
              <g class="map-table" data-table="32">
                <circle cx="372.8" cy="510.90" r="32" />
                <text x="372.8" y="516.90" text-anchor="middle" font-size="24">32</text>
              </g>
              <g class="map-table" data-table="33">
                <circle cx="470.4" cy="510.90" r="32" />
                <text x="470.4" y="516.90" text-anchor="middle" font-size="24">33</text>
              </g>

              <!-- Row 7: 38 37 36 35 34 -->
              <g class="map-table" data-table="38">
                <circle cx="80" cy="595.09" r="32" />
                <text x="80" y="601.09" text-anchor="middle" font-size="24">38</text>
              </g>
              <g class="map-table" data-table="37">
                <circle cx="177.6" cy="595.09" r="32" />
                <text x="177.6" y="601.09" text-anchor="middle" font-size="24">37</text>
              </g>
              <g class="map-table" data-table="36">
                <circle cx="275.2" cy="595.09" r="32" />
                <text x="275.2" y="601.09" text-anchor="middle" font-size="24">36</text>
              </g>
              <g class="map-table" data-table="35">
                <circle cx="372.8" cy="595.09" r="32" />
                <text x="372.8" y="601.09" text-anchor="middle" font-size="24">35</text>
              </g>
              <g class="map-table" data-table="34">
                <circle cx="470.4" cy="595.09" r="32" />
                <text x="470.4" y="601.09" text-anchor="middle" font-size="24">34</text>
              </g>

              <!-- Row 8: 39 40 41 42 43 -->
              <g class="map-table" data-table="39">
                <circle cx="80" cy="679.27" r="32" />
                <text x="80" y="685.27" text-anchor="middle" font-size="24">39</text>
              </g>
              <g class="map-table" data-table="40">
                <circle cx="177.6" cy="679.27" r="32" />
                <text x="177.6" y="685.27" text-anchor="middle" font-size="24">40</text>
              </g>
              <g class="map-table" data-table="41">
                <circle cx="275.2" cy="679.27" r="32" />
                <text x="275.2" y="685.27" text-anchor="middle" font-size="24">41</text>
              </g>
              <g class="map-table" data-table="42">
                <circle cx="372.8" cy="679.27" r="32" />
                <text x="372.8" y="685.27" text-anchor="middle" font-size="24">42</text>
              </g>
              <g class="map-table" data-table="43">
                <circle cx="470.4" cy="679.27" r="32" />
                <text x="470.4" y="685.27" text-anchor="middle" font-size="24">43</text>
              </g>

              <!-- Row 9: 49 48 47 46 45 44 -->
              <g class="map-table" data-table="49">
                <circle cx="80" cy="763.45" r="32" />
                <text x="80" y="769.45" text-anchor="middle" font-size="24">49</text>
              </g>
              <g class="map-table" data-table="48">
                <circle cx="177.6" cy="763.45" r="32" />
                <text x="177.6" y="769.45" text-anchor="middle" font-size="24">48</text>
              </g>
              <g class="map-table" data-table="47">
                <circle cx="275.2" cy="763.45" r="32" />
                <text x="275.2" y="769.45" text-anchor="middle" font-size="24">47</text>
              </g>
              <g class="map-table" data-table="46">
                <circle cx="372.8" cy="763.45" r="32" />
                <text x="372.8" y="769.45" text-anchor="middle" font-size="24">46</text>
              </g>
              <g class="map-table" data-table="45">
                <circle cx="470.4" cy="763.45" r="32" />
                <text x="470.4" y="769.45" text-anchor="middle" font-size="24">45</text>
              </g>
              <g class="map-table" data-table="44">
                <circle cx="568" cy="763.45" r="32" />
                <text x="568" y="769.45" text-anchor="middle" font-size="24">44</text>
              </g>

              <!-- Row 10: 50 51 52 53 54 55 -->
              <g class="map-table" data-table="50">
                <circle cx="80" cy="847.64" r="32" />
                <text x="80" y="853.64" text-anchor="middle" font-size="24">50</text>
              </g>
              <g class="map-table" data-table="51">
                <circle cx="177.6" cy="847.64" r="32" />
                <text x="177.6" y="853.64" text-anchor="middle" font-size="24">51</text>
              </g>
              <g class="map-table" data-table="52">
                <circle cx="275.2" cy="847.64" r="32" />
                <text x="275.2" y="853.64" text-anchor="middle" font-size="24">52</text>
              </g>
              <g class="map-table" data-table="53">
                <circle cx="372.8" cy="847.64" r="32" />
                <text x="372.8" y="853.64" text-anchor="middle" font-size="24">53</text>
              </g>
              <g class="map-table" data-table="54">
                <circle cx="470.4" cy="847.64" r="32" />
                <text x="470.4" y="853.64" text-anchor="middle" font-size="24">54</text>
              </g>
              <g class="map-table" data-table="55">
                <circle cx="568" cy="847.64" r="32" />
                <text x="568" y="853.64" text-anchor="middle" font-size="24">55</text>
              </g>

              <!-- Row 11: 61 60 59 58 57 56 -->
              <g class="map-table" data-table="61">
                <circle cx="80" cy="931.82" r="32" />
                <text x="80" y="937.82" text-anchor="middle" font-size="24">61</text>
              </g>
              <g class="map-table" data-table="60">
                <circle cx="177.6" cy="931.82" r="32" />
                <text x="177.6" y="937.82" text-anchor="middle" font-size="24">60</text>
              </g>
              <g class="map-table" data-table="59">
                <circle cx="275.2" cy="931.82" r="32" />
                <text x="275.2" y="937.82" text-anchor="middle" font-size="24">59</text>
              </g>
              <g class="map-table" data-table="58">
                <circle cx="372.8" cy="931.82" r="32" />
                <text x="372.8" y="937.82" text-anchor="middle" font-size="24">58</text>
              </g>
              <g class="map-table" data-table="57">
                <circle cx="470.4" cy="931.82" r="32" />
                <text x="470.4" y="937.82" text-anchor="middle" font-size="24">57</text>
              </g>
              <g class="map-table" data-table="56">
                <circle cx="568" cy="931.82" r="32" />
                <text x="568" y="937.82" text-anchor="middle" font-size="24">56</text>
              </g>

              <!-- Row 12: 62 63 64 65 66 67 -->
              <g class="map-table" data-table="62">
                <circle cx="80" cy="1016" r="32" />
                <text x="80" y="1022" text-anchor="middle" font-size="24">62</text>
              </g>
              <g class="map-table" data-table="63">
                <circle cx="177.6" cy="1016" r="32" />
                <text x="177.6" y="1022" text-anchor="middle" font-size="24">63</text>
              </g>
              <g class="map-table" data-table="64">
                <circle cx="275.2" cy="1016" r="32" />
                <text x="275.2" y="1022" text-anchor="middle" font-size="24">64</text>
              </g>
              <g class="map-table" data-table="65">
                <circle cx="372.8" cy="1016" r="32" />
                <text x="372.8" y="1022" text-anchor="middle" font-size="24">65</text>
              </g>
              <g class="map-table" data-table="66">
                <circle cx="470.4" cy="1016" r="32" />
                <text x="470.4" y="1022" text-anchor="middle" font-size="24">66</text>
              </g>
              <g class="map-table" data-table="67">
                <circle cx="568" cy="1016" r="32" />
                <text x="568" y="1022" text-anchor="middle" font-size="24">67</text>
              </g>
            </svg>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // Expected CSV header names
    const CSV_HEADERS = {
      FIRST_NAMES: "First Names",
      LAST_NAME: "Last Name",
      COMPANY: "Company",
      TABLE: "Table"
    };

    const state = {
      guests: [],
      mode: "search", // "search" | "table"
      searchTerm: "",
      selectedTable: "",
      loaded: false,
      tableGuestCounts: {}
    };

    const dom = {};

    document.addEventListener("DOMContentLoaded", () => {
      cacheDom();
      bindEvents();
      loadCsv();
    });

    function cacheDom() {
      dom.modeSearchBtn = document.getElementById("mode-search");
      dom.modeTableBtn = document.getElementById("mode-table");
      dom.searchPanel = document.getElementById("panel-search");
      dom.tablePanel = document.getElementById("panel-table");
      dom.searchInput = document.getElementById("searchInput");
      dom.tableSelect = document.getElementById("tableSelect");
      dom.results = document.getElementById("results");
      dom.errorMessage = document.getElementById("errorMessage");
      dom.activeFilter = document.getElementById("activeFilter");
      dom.clearSearchBtn = document.getElementById("clearSearch");
      dom.roomMapWrapper = document.getElementById("roomMapWrapper");
      dom.mapTables = document.querySelectorAll(".map-table");
    }

    function bindEvents() {
      dom.modeSearchBtn.addEventListener("click", () => setMode("search"));
      dom.modeTableBtn.addEventListener("click", () => setMode("table"));

      dom.searchInput.addEventListener("input", () => {
        state.searchTerm = dom.searchInput.value;
        render();
      });

      dom.tableSelect.addEventListener("change", () => {
        // Dropdown kept hidden; code left for completeness
        state.selectedTable = dom.tableSelect.value;
        render();
      });

      if (dom.clearSearchBtn) {
        dom.clearSearchBtn.addEventListener("click", () => {
          state.searchTerm = "";
          dom.searchInput.value = "";
          render();
          dom.searchInput.focus();
        });
      }

      // Clicking a table on the map selects that table
      if (dom.mapTables && dom.mapTables.forEach) {
        dom.mapTables.forEach(el => {
          el.addEventListener("click", () => {
            const table = el.getAttribute("data-table");
            if (!table) return;
            setMode("table");
            state.selectedTable = table;
            dom.tableSelect.value = table; // keeps things in sync, even if hidden
            render();
            dom.results.scrollTop = 0;
          });
        });
      }
    }

    async function loadCsv() {
      try {
        const response = await fetch("attendees.csv", {
          headers: { "Accept": "text/csv" }
        });
        if (!response.ok) {
          throw new Error("Could not load attendees.csv (HTTP " + response.status + ")");
        }
        const text = await response.text();
        state.guests = parseCsv(text);
        state.tableGuestCounts = computeTableGuestCounts(state.guests);
        state.loaded = true;
        buildTableDropdown(state.guests); // fills hidden dropdown
        render();
      } catch (err) {
        console.error(err);
        dom.errorMessage.style.display = "block";
        dom.errorMessage.textContent =
          "There was a problem loading the guest list. Please let a member of the event team know.";
        dom.activeFilter.textContent = "Guest list unavailable.";
        dom.results.innerHTML = "";
      }
    }

    // Normalise strings for search
    function normalizeForSearch(str) {
      return (str || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/['’`]/g, "")
        .replace(/[^a-z0-9\s]/g, " ")
        .replace(/\s+/g, " ")
        .trim();
    }

    function parseCsv(text) {
      const lines = text
        .trim()
        .split(/\r?\n/)
        .filter(line => line.trim().length > 0);

      if (lines.length < 2) return [];

      const headerLine = lines[0];
      const headers = headerLine.split(",").map(h => h.trim());
      const indexMap = {};
      headers.forEach((h, i) => {
        indexMap[h.toLowerCase()] = i;
      });

      function idx(label) {
        const key = label.toLowerCase();
        return key in indexMap ? indexMap[key] : -1;
      }

      const firstIdx = idx(CSV_HEADERS.FIRST_NAMES);
      const lastIdx = idx(CSV_HEADERS.LAST_NAME);
      const companyIdx = idx(CSV_HEADERS.COMPANY);
      const tableIdx = idx(CSV_HEADERS.TABLE);

      const guests = [];

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        if (!line.trim()) continue;
        const cols = line.split(",").map(c => c.trim());

        const firstNames = firstIdx >= 0 ? (cols[firstIdx] || "") : (cols[0] || "");
        const lastName   = lastIdx  >= 0 ? (cols[lastIdx]  || "") : (cols[1] || "");
        const company    = companyIdx >= 0 ? (cols[companyIdx] || "") : (cols[2] || "");
        const table      = tableIdx >= 0 ? (cols[tableIdx] || "") : (cols[3] || "");

        if (!firstNames && !lastName && !company && !table) continue;

        const guest = {
          firstNames,
          lastName,
          company,
          table
        };

        guest._search = normalizeForSearch(
          `${firstNames} ${lastName} ${company}`
        );

        guests.push(guest);
      }

      guests.sort((a, b) => {
        const lastCmp = a.lastName.localeCompare(b.lastName, undefined, {
          sensitivity: "base"
        });
        if (lastCmp !== 0) return lastCmp;
        return a.firstNames.localeCompare(b.firstNames, undefined, {
          sensitivity: "base"
        });
      });

      return guests;
    }

    function computeTableGuestCounts(guests) {
      const counts = {};
      guests.forEach(g => {
        const table = (g.table || "").trim();
        if (!table) return;
        counts[table] = (counts[table] || 0) + 1;
      });
      return counts;
    }

    function buildTableDropdown(guests) {
      const tables = Array.from(
        new Set(
          guests
            .map(g => (g.table || "").trim())
            .filter(t => t.length > 0)
        )
      );

      const allNumeric = tables.every(t => /^-?\d+$/.test(t));
      if (allNumeric) {
        tables.sort((a, b) => Number(a) - Number(b));
      } else {
        tables.sort((a, b) =>
          a.localeCompare(b, undefined, { sensitivity: "base", numeric: true })
        );
      }

      for (const table of tables) {
        const opt = document.createElement("option");
        opt.value = table;
        opt.textContent = table;
        dom.tableSelect.appendChild(opt);
      }
    }

    function setMode(mode) {
      if (mode === state.mode) return;
      state.mode = mode;

      if (mode === "search") {
        dom.modeSearchBtn.classList.add("active");
        dom.modeTableBtn.classList.remove("active");
        dom.modeSearchBtn.setAttribute("aria-selected", "true");
        dom.modeTableBtn.setAttribute("aria-selected", "false");
        dom.searchPanel.style.display = "";
        dom.tablePanel.style.display = "none"; // stays hidden
        dom.searchInput.focus();
      } else {
        dom.modeTableBtn.classList.add("active");
        dom.modeSearchBtn.classList.remove("active");
        dom.modeTableBtn.setAttribute("aria-selected", "true");
        dom.modeSearchBtn.setAttribute("aria-selected", "false");
        dom.searchPanel.style.display = "none";
        dom.tablePanel.style.display = "none";
      }

      render();
    }

    function getFilteredGuests() {
      if (!state.loaded) return [];

      if (state.mode === "search") {
        const term = normalizeForSearch(state.searchTerm);
        if (!term) {
          return [];
        }
        return state.guests.filter(g => g._search.includes(term));
      } else {
        const table = (state.selectedTable || "").trim();
        if (!table) {
          return [];
        }
        return state.guests.filter(
          g => (g.table || "").toLowerCase() === table.toLowerCase()
        );
      }
    }

    function updateMapHighlight() {
      if (!dom.roomMapWrapper || !dom.mapTables) return;

      const isTableMode = state.mode === "table";
      const table = (state.selectedTable || "").trim();

      if (!isTableMode) {
        dom.roomMapWrapper.style.display = "none";
        dom.mapTables.forEach(el => el.classList.remove("active"));
        return;
      }

      // In table mode: always show the map
      dom.roomMapWrapper.style.display = "";

      dom.mapTables.forEach(el => {
        const isActive = table && el.getAttribute("data-table") === table;
        el.classList.toggle("active", !!isActive);
      });
    }

    function render() {
      if (!state.loaded) {
        dom.activeFilter.textContent = "Loading guest list…";
        dom.results.innerHTML = "";
        updateMapHighlight();
        return;
      }

      const isSearchMode = state.mode === "search";
      const searchTermNormalized = normalizeForSearch(state.searchTerm);
      const selectedTableTrimmed = (state.selectedTable || "").trim();
      const hasQuery = isSearchMode
        ? searchTermNormalized.length > 0
        : selectedTableTrimmed.length > 0;

      if (dom.clearSearchBtn) {
        if (searchTermNormalized.length > 0 && isSearchMode) {
          dom.clearSearchBtn.style.display = "flex";
        } else {
          dom.clearSearchBtn.style.display = "none";
        }
      }

      // Summary text (top right)
      if (!hasQuery) {
        dom.activeFilter.textContent = "";
      } else if (isSearchMode) {
        dom.activeFilter.textContent = state.searchTerm
          ? `Filter: “${state.searchTerm}”`
          : "";
      } else {
        const table = selectedTableTrimmed;
        if (table) {
          const count = (state.tableGuestCounts && state.tableGuestCounts[table]) || 0;
          let label;
          if (count === 0) {
            label = `Table: ${table}`;
          } else if (count === 1) {
            label = `Table: ${table} (1 guest)`;
          } else {
            label = `Table: ${table} (${count} guests)`;
          }
          dom.activeFilter.textContent = label;
        } else {
          dom.activeFilter.textContent = "";
        }
      }

      // No query yet: show hints, no results
      if (!hasQuery) {
        if (isSearchMode) {
          dom.results.innerHTML =
            '<div class="empty-state">Begin by typing a first name, last name, or company.</div>';
        } else {
          // In table mode, rely on the map header/hint only
          dom.results.innerHTML = "";
        }
        updateMapHighlight();
        return;
      }

      const guests = getFilteredGuests();

      if (guests.length === 0) {
        const msg = isSearchMode
          ? "No results found. Please check the spelling or try a different name or company."
          : "No results found for this table.";
        dom.results.innerHTML = `<div class="empty-state">${msg}</div>`;
        updateMapHighlight();
        return;
      }

      const fragment = document.createDocumentFragment();

      guests.forEach(g => {
        const wrapper = document.createElement("article");
        wrapper.className = "result-item";

        const nameEl = document.createElement("div");
        nameEl.className = "result-name";
        nameEl.textContent = `${g.firstNames} ${g.lastName}`.trim();

        const companyEl = document.createElement("div");
        companyEl.className = "result-company";
        companyEl.textContent = g.company || "—";

        const tableEl = document.createElement("button");
        tableEl.className = "result-table table-link";
        tableEl.textContent = `TABLE ${g.table || "TBC"}`;
        tableEl.setAttribute("data-table", g.table);
        tableEl.type = "button";

        wrapper.appendChild(nameEl);
        wrapper.appendChild(companyEl);
        wrapper.appendChild(tableEl);

        fragment.appendChild(wrapper);
      });

      dom.results.innerHTML = "";
      dom.results.appendChild(fragment);

      // TIP under results in search mode
      if (isSearchMode) {
        const hint = document.createElement("div");
        hint.className = "results-hint";
        hint.textContent = "TIP: Tap the table number to see where it is in the room.";
        dom.results.appendChild(hint);
      }

      // Clicking "TABLE X" in results switches to table mode and highlights on map
      const tableLinks = dom.results.querySelectorAll(".table-link");
      tableLinks.forEach(btn => {
        btn.addEventListener("click", () => {
          const table = btn.getAttribute("data-table");

          state.mode = "table";
          dom.modeSearchBtn.classList.remove("active");
          dom.modeTableBtn.classList.add("active");
          dom.modeSearchBtn.setAttribute("aria-selected", "false");
          dom.modeTableBtn.setAttribute("aria-selected", "true");
          dom.searchPanel.style.display = "none";
          dom.tablePanel.style.display = "none";

          dom.tableSelect.value = table;
          state.selectedTable = table;

          render();
          dom.results.scrollTop = 0;
        });
      });

      updateMapHighlight();
    }
  </script>
</body>
</html>
